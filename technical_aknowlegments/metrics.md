# Core Web Vitals и метрики производительности фронтенда

**Core Web Vitals** — это набор ключевых метрик производительности веб-страниц, которые Google использует для оценки пользовательского опыта и ранжирования в поиске.

---

## Три основные метрики Core Web Vitals

### 1. LCP (Largest Contentful Paint)

**Что измеряет:** Скорость загрузки основного контента страницы.

LCP показывает время, за которое отображается самый крупный видимый элемент на странице (изображение, блок текста, видео).

#### Хорошие значения

| Оценка | Время |
|--------|-------|
| **Хорошо** | < 2.5 сек |
| **Требует улучшения** | 2.5 - 4 сек |
| **Плохо** | > 4 сек |

#### Что влияет на LCP

- Скорость сервера (TTFB)
- Блокирующие CSS и JavaScript
- Время загрузки ресурсов (изображения, шрифты)
- Рендеринг на стороне клиента

#### Как оптимизировать

- Использовать CDN
- Оптимизировать изображения (WebP, lazy-load)
- Минимизировать CSS/JS
- Использовать server-side rendering (SSR)
- Предзагрузка критических ресурсов (`<link rel="preload">`)

---

### 2. FID (First Input Delay)

**Что измеряет:** Задержка первого взаимодействия пользователя со страницей.

FID измеряет время от момента, когда пользователь впервые взаимодействует со страницей (клик, тап, нажатие клавиши), до момента, когда браузер может обработать это событие.

#### Хорошие значения

| Оценка | Время |
|--------|-------|
| **Хорошо** | < 100 мс |
| **Требует улучшения** | 100 - 300 мс |
| **Плохо** | > 300 мс |

#### Что влияет на FID

- Тяжёлые JavaScript-задачи
- Блокирование main thread
- Долгие вычисления при загрузке

#### Как оптимизировать

- Разбить длинные задачи на меньшие (code splitting)
- Использовать Web Workers для тяжёлых вычислений
- Отложить загрузку второстепенного JS (defer/async)
- Уменьшить время выполнения JavaScript

---

### 3. CLS (Cumulative Layout Shift)

**Что измеряет:** Стабильность визуального отображения страницы.

CLS показывает, насколько сильно элементы страницы "прыгают" во время загрузки. Чем меньше значение — тем стабильнее интерфейс.

#### Хорошие значения

| Оценка | Значение |
|--------|----------|
| **Хорошо** | < 0.1 |
| **Требует улучшения** | 0.1 - 0.25 |
| **Плохо** | > 0.25 |

#### Что вызывает CLS

- Изображения без указанных размеров
- Динамически добавляемый контент (реклама, баннеры)
- Веб-шрифты, вызывающие FOIT/FOUT
- Медленно загружаемые iframe

#### Как оптимизировать

- Указывать размеры для изображений и видео (`width` и `height`)
- Резервировать место под динамический контент
- Использовать `font-display: swap` для шрифтов
- Избегать вставки контента над существующим

---

## Дополнительные метрики

### TTI (Time to Interactive)

**Что измеряет:** Время до полной интерактивности страницы.

TTI показывает, через сколько времени после загрузки страница становится полностью интерактивной — пользователь может кликать, вводить данные и интерфейс стабильно реагирует.

#### Хорошие значения

| Оценка | Время |
|--------|-------|
| **Хорошо** | < 3.8 сек |
| **Умеренно** | 3.9 - 7.3 сек |
| **Плохо** | > 7.3 сек |

#### Что включает

- Загрузку HTML, CSS, JS, изображений
- Выполнение JavaScript (в том числе блокирующего)
- Отрисовку основного контента
- Готовность обработчиков событий

#### Как оптимизировать

- Lazy-load и code splitting
- Defer/async для скриптов
- Web Workers для тяжёлых вычислений
- Critical CSS — инлайнить только критические стили
- Минимизировать работу main thread

---

### TBT (Total Blocking Time)

**Что измеряет:** Суммарное время блокировки main thread.

TBT измеряет общее время, в течение которого main thread был заблокирован настолько, что не мог обрабатывать пользовательский ввод.

Считается сумма всех "долгих задач" (long tasks > 50 мс) между FCP и TTI.

#### Хорошие значения

| Оценка | Время |
|--------|-------|
| **Хорошо** | < 200 мс |
| **Требует улучшения** | 200 - 600 мс |
| **Плохо** | > 600 мс |

#### Что вызывает TBT

- Тяжёлые JavaScript-вычисления
- Парсинг и выполнение больших JS-бандлов
- Синхронные API-запросы
- Сложные DOM-манипуляции

#### Как оптимизировать

- Разбивать длинные задачи (используя `requestIdleCallback`)
- Уменьшать размер JavaScript-бандлов
- Оптимизировать сторонние скрипты
- Использовать code splitting и lazy loading

---

## Сводная таблица метрик

| Метрика | Что измеряет | Хорошее значение | Основная цель |
|---------|--------------|------------------|---------------|
| **LCP** | Скорость загрузки основного контента | < 2.5 сек | Воспринимаемая скорость загрузки |
| **FID** | Задержка первого взаимодействия | < 100 мс | Отзывчивость интерфейса |
| **CLS** | Стабильность визуального отображения | < 0.1 | Визуальная стабильность |
| **TTI** | Время до полной интерактивности | < 3.8 сек | Готовность к взаимодействию |
| **TBT** | Суммарное время блокировки | < 200 мс | Плавность работы |

---

## Как измерять

### Инструменты

- **Google Lighthouse** — встроен в Chrome DevTools
- **PageSpeed Insights** — онлайн-анализатор от Google
- **Web Vitals Extension** — расширение для Chrome
- **Chrome UX Report** — реальные данные от пользователей
- **Real User Monitoring (RUM)** — Datadog, New Relic, Sentry

### Где смотреть

1. **Chrome DevTools → Lighthouse** — локальное тестирование
2. **search.google.com/search-console** — данные от реальных пользователей
3. **web.dev/measure** — быстрая проверка сайта

---

## Почему это важно

- ✅ Влияет на SEO и ранжирование в Google
- ✅ Улучшает пользовательский опыт
- ✅ Повышает конверсию (каждая секунда загрузки критична)
- ✅ Снижает bounce rate (показатель отказов)

> Исследования показывают, что улучшение LCP с 4 до 2 секунд может увеличить конверсию на 15-20%.

---

## Связь с другими практиками

Core Web Vitals связаны с:

- **Performance Budget** — ограничения на размер бандлов и время загрузки
- **Progressive Web Apps (PWA)** — оффлайн-режим, предзагрузка
- **Critical Rendering Path** — оптимизация порядка загрузки ресурсов
- **CDN и Edge Computing** — ускорение доставки контента

